---
title: "ç”Ÿäº§çº§æ™ºèƒ½å•†å“æœç´¢ç³»ç»Ÿ"
category: Scene technology
startDate: 2024-02-09
endDate: 2024-12-09
publishedAt: 2024-06-10
summary: "Final Project of CE2012 - Assembly Language and System Programming"
tags:
  - Assembly
  - Game
  - Ascii Art
  - Tank
  - Bogy
banner: /images/banner/projects/hua-tank.webp
alt: "Hua Tank V.S. Bogy | Final Project of CE2012 - Assembly Language and System Programming"
---




# é¡¹ç›®äº®å‰‘ï¼šæ„å»ºç”Ÿäº§çº§æ™ºèƒ½å•†å“æœç´¢ç³»ç»Ÿå®æˆ˜ ğŸš€

æœ¬é¡¹ç›®å°†æ·±å…¥å®æˆ˜ï¼Œä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ª**ç”Ÿäº§çº§åˆ«çš„æ™ºèƒ½å•†å“æœç´¢ç³»ç»Ÿ**ã€‚æˆ‘ä»¬å°†ä¸ä»…ä»…åœç•™åœ¨ç†è®ºå±‚é¢ï¼Œè€Œæ˜¯äº²æ‰‹æ“åˆ€ï¼Œè§£å†³çœŸå®ä¸–ç•Œä¸­ä¼šé‡åˆ°çš„å„ç§æŒ‘æˆ˜ï¼Œæ¶µç›–ä»**Elasticsearché›†ç¾¤çš„éƒ¨ç½²**ï¼Œåˆ°**ä¸­æ–‡åˆ†è¯å™¨çš„æ·±åº¦å®šåˆ¶**ï¼Œå†åˆ°**æµ·é‡æ•°æ®çš„é«˜æ•ˆå¤„ç†**ä¸**æè‡´çš„æœç´¢æ€§èƒ½ä¼˜åŒ–**ã€‚

**æœ¬é¡¹ç›®å°†å®è·µä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯ä¸ç»éªŒï¼š**

1.  **åšå¦‚ç£çŸ³ï¼šç”Ÿäº§ç¯å¢ƒESé›†ç¾¤éƒ¨ç½²ä¸è¿ç»´** ğŸ­
*   å‘Šåˆ«å•æœºæ¼”ç¤ºï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨å¤šèŠ‚ç‚¹ç¯å¢ƒä¸‹è§„åˆ’ã€éƒ¨ç½²å’Œé…ç½®ä¸€ä¸ªé«˜å¯ç”¨ã€å¯æ‰©å±•çš„Elasticsearchç”Ÿäº§é›†ç¾¤ã€‚
*   æ·±å…¥æ¢è®¨èŠ‚ç‚¹è§’è‰²ã€é›†ç¾¤å‘ç°ã€æ•…éšœè½¬ç§»ã€ç›‘æ§å‘Šè­¦ç­‰å…³é”®è¿ç»´çŸ¥è¯†ï¼Œç¡®ä¿ä½ çš„æœç´¢å¼•æ“7x24å°æ—¶ç¨³å®šè¿è¡Œã€‚

2.  **ç‹¬å…·åŒ å¿ƒï¼šIKåˆ†è¯å™¨æºç äºŒæ¬¡å¼€å‘ä¸Pinyinåˆ†è¯å™¨é›†æˆ** ğŸ”ª
*   çªç ´åŸç”ŸIKåˆ†è¯å™¨çš„å±€é™ã€‚æˆ‘ä»¬å°†äº²è‡ªåŠ¨æ‰‹ä¿®æ”¹IKæºç ï¼Œå®ç°**ä»æ•°æ®åº“åŠ¨æ€åŠ è½½å’Œçƒ­æ›´æ–°è¯å…¸**çš„å¼ºå¤§åŠŸèƒ½ï¼Œè®©ä½ çš„åˆ†è¯å™¨å®æ—¶æŒæ¡ç½‘ç»œæ–°è¯ã€è¡Œä¸šæœ¯è¯­ã€‚
*   é›†æˆ**Pinyinåˆ†è¯å™¨**ï¼Œå®Œç¾æ”¯æŒç”¨æˆ·é€šè¿‡æ‹¼éŸ³è¾“å…¥è¿›è¡Œå•†å“æœç´¢å’Œæ™ºèƒ½æç¤ºï¼Œå¤§å¹…æå‡ç”¨æˆ·ä½“éªŒã€‚

3.  **åŒå‰‘åˆç’§ï¼šå•†å“ä¸»ç´¢å¼•ä¸Suggestå»ºè®®ç´¢å¼•çš„ç²¾å¦™è®¾è®¡** ğŸ›ï¸â•ğŸ”®
*   ç²¾å¿ƒè®¾è®¡**å•†å“ä¸»ç´¢å¼• (Product Index)** çš„Mappingï¼Œä¼˜åŒ–å­—æ®µç±»å‹å’Œåˆ†è¯ç­–ç•¥ï¼Œä¸ºæ ¸å¿ƒçš„å•†å“æœç´¢ã€ç­›é€‰ã€æ’åºæä¾›åšå®åŸºç¡€ã€‚
*   ç‹¬ç«‹æ„å»º**æœç´¢å»ºè®®ç´¢å¼• (Suggest Index)**ï¼Œä¸“é—¨æœåŠ¡äºæœç´¢æ¡†çš„**è‡ªåŠ¨è¡¥å…¨ (Completion Suggester)** å’Œ **æ‹¼å†™çº é”™ (Phrase/Term Suggester)** åŠŸèƒ½ï¼Œè®©ç”¨æˆ·çš„æ¯ä¸€æ¬¡è¾“å…¥éƒ½å……æ»¡â€œæ™ºèƒ½æ„Ÿâ€ã€‚

4.  **æµ·é‡æ•°æ®å¤„ç†ï¼šç”Ÿäº§çº§å…¨é‡å•†å“æ•°æ®å†™å…¥ESå®æˆ˜ä¸ä¼˜åŒ–** ğŸŒŠ
*   é¢å¯¹**ç™¾ä¸‡çº§ç”šè‡³äº¿çº§**çš„å•†å“æ•°æ®ï¼Œå¦‚ä½•é«˜æ•ˆã€ç¨³å®šåœ°å°†å…¶ä»æ•°æ®æºï¼ˆå¦‚MySQLï¼‰åŒæ­¥åˆ°Elasticsearchï¼Ÿæˆ‘ä»¬å°†ç¼–å†™ç”Ÿäº§çº§çš„Javaä»£ç ï¼Œåˆ©ç”¨Bulk APIè¿›è¡Œ**æ‰¹é‡å†™å…¥**ã€‚
*   æ·±å…¥æ¢è®¨æ•°æ®å†™å…¥è¿‡ç¨‹ä¸­çš„**æ€§èƒ½ç“¶é¢ˆåˆ†æ**ä¸**ä¼˜åŒ–ç­–ç•¥**ï¼Œå¦‚è°ƒæ•´æ‰¹å¤„ç†å¤§å°ã€å¹¶å‘æ§åˆ¶ã€ESé›†ç¾¤å‚æ•°è°ƒä¼˜ç­‰ï¼Œç¡®ä¿æ•°æ®åŒæ­¥çš„æ•ˆç‡å’ŒæˆåŠŸç‡ã€‚

5.  **æ ¸å¿ƒå¼•æ“ï¼šå•†å“æ ¸å¿ƒæœç´¢æ¥å£çš„ç²¾ç»†åŒ–å®ç°** ğŸ”
*   åŸºäºElasticsearchå¼ºå¤§çš„Query DSLï¼Œå®ç°æ”¯æŒå¤šç§æ¡ä»¶çš„å•†å“æœç´¢æ¥å£ï¼ŒåŒ…æ‹¬ï¼š
*   å…³é”®è¯å…¨æ–‡æ£€ç´¢ï¼ˆè·¨å¤šä¸ªå­—æ®µï¼Œå¦‚åç§°ã€æè¿°ï¼‰ã€‚
*   ç»“æ„åŒ–ç­›é€‰ï¼ˆæŒ‰åˆ†ç±»ã€å“ç‰Œã€ä»·æ ¼åŒºé—´ç­‰ï¼‰ã€‚
*   å¤æ‚æ’åºï¼ˆæŒ‰ç›¸å…³åº¦ã€ä»·æ ¼ã€é”€é‡ã€æ–°å“ç­‰ï¼‰ã€‚
*   ç²¾å‡†åˆ†é¡µã€‚
*   å…³æ³¨æœç´¢ç»“æœçš„**ç›¸å…³æ€§æ’åº**ï¼Œç¡®ä¿ç”¨æˆ·æœ€æƒ³è¦çš„ç»“æœæ’åœ¨æœ€å‰é¢ã€‚

6.  **æ€§èƒ½æé™æŒ‘æˆ˜ï¼šäº¿çº§å•†å“æ•°æ®æœç´¢æ€§èƒ½æµ‹è¯•ä¸æè‡´ä¼˜åŒ–** â±ï¸âš¡
*   æ¨¡æ‹ŸçœŸå®ç”¨æˆ·åœºæ™¯ï¼Œå¯¹åŒ…å«**äº¿çº§**å•†å“æ•°æ®çš„Elasticsearché›†ç¾¤è¿›è¡Œ**å‹åŠ›æµ‹è¯•å’Œæ€§èƒ½åˆ†æ**ã€‚
*   è¯†åˆ«æœç´¢ç“¶é¢ˆï¼ˆæ…¢æŸ¥è¯¢ã€é«˜CPU/å†…å­˜æ¶ˆè€—ã€ç£ç›˜I/Oç“¶é¢ˆç­‰ï¼‰ï¼Œå¹¶è¿ç”¨å„ç§ESè°ƒä¼˜æŠ€å·§ï¼ˆæŸ¥è¯¢æ”¹å†™ã€ç¼“å­˜ç­–ç•¥ã€ç´¢å¼•ä¼˜åŒ–ã€ç¡¬ä»¶å‡çº§ç­‰ï¼‰è¿›è¡Œ**æè‡´æ€§èƒ½ä¼˜åŒ–**ï¼Œè¿½æ±‚æ¯«ç§’çº§çš„æœç´¢å“åº”ã€‚

7.  **æ™ºèƒ½äº¤äº’ï¼šè¾“å…¥æ¡†è‡ªåŠ¨è¡¥å…¨ä¸æ‹¼å†™çº é”™åŠŸèƒ½å®æˆ˜** ğŸ’¡âœï¸
*   åˆ©ç”¨Suggest APIï¼Œä¸ºå‰ç«¯æœç´¢æ¡†å®ç°æµç•…çš„**è¾“å…¥å³æç¤º (Search-as-you-type)** åŠŸèƒ½ã€‚
*   å½“ç”¨æˆ·è¾“å…¥æœ‰è¯¯æˆ–ä¸å®Œæ•´æ—¶ï¼Œæä¾›æ™ºèƒ½çš„**æ‹¼å†™çº é”™**å»ºè®®ï¼Œå¼•å¯¼ç”¨æˆ·å¿«é€Ÿæ‰¾åˆ°æ­£ç¡®çš„ç›®æ ‡ã€‚

**é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œä¸ä»…ä»…æ˜¯å­¦ä¹ Elasticsearchçš„APIè°ƒç”¨ï¼Œæ›´æ˜¯å®Œæ•´ä½“éªŒä¸€ä¸ªçœŸå®æœç´¢ç³»ç»Ÿçš„æ„å»ºã€ä¼˜åŒ–å’Œè¿­ä»£è¿‡ç¨‹ï¼Œè·å¾—å®è´µçš„ç”Ÿäº§å®è·µç»éªŒã€‚**




# IKåˆ†è¯å™¨å¼€å‘å®æˆ˜

ç”¨è¿‡ESåšä¸­æ–‡æœç´¢çš„æœ‹å‹ï¼Œå¯¹IKåˆ†è¯å™¨ä¸€å®šä¸é™Œç”Ÿã€‚å®ƒå¼€æºã€å¥½ç”¨ï¼Œæ˜¯å¾ˆå¤šé¡¹ç›®ä¸­æ–‡åˆ†è¯çš„é¦–é€‰ã€‚ä½†æœ‰æ—¶å€™ï¼ŒåŸç”Ÿçš„IKåˆ†è¯å™¨ç›´æ¥æ‹¿æ¥ç”¨ï¼Œå¯èƒ½ä¼šè§‰å¾—å·®é‚£ä¹ˆç‚¹æ„æ€ï¼Œå°¤å…¶æ˜¯åœ¨è¯åº“æ›´æ–°è¿™å—å„¿ã€‚

æ¯”å¦‚ï¼Œç½‘ç»œçƒ­è¯ã€è¡Œä¸šæ–°è¯å±‚å‡ºä¸ç©·ï¼Œå¦‚æœæˆ‘ä»¬çš„åˆ†è¯å™¨è¯åº“è¿˜æ˜¯è€å¤è‘£ï¼Œé‚£åˆ†è¯æ•ˆæœè‡ªç„¶å°±è·Ÿä¸ä¸Šæ—¶ä»£äº†ã€‚æ¯”å¦‚ç”¨æˆ·æœâ€œæ°´æ± é‡Œé¢é“¶é¾™é±¼â€ï¼Œå¦‚æœâ€œé“¶é¾™é±¼â€ä¸åœ¨è¯åº“é‡Œï¼Œå¾ˆå¯èƒ½å°±è¢«æ‹†å¾—ä¸ƒé›¶å…«è½ï¼Œæœç´¢ç»“æœè‡ªç„¶ä¹Ÿå°±è·‘åäº†ã€‚

æ‰€ä»¥ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ’¸èµ·è¢–å­ï¼Œå¯¹IKåˆ†è¯å™¨çš„æºç è¿›è¡ŒäºŒå¼€ï¼Œè®©å®ƒèƒ½æ›´æ™ºèƒ½ã€æ›´åŠæ—¶åœ°æ›´æ–°è¯åº“ã€‚è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠæ€ä¹ˆæ”¹é€ IKåˆ†è¯å™¨ï¼Œç‰¹åˆ«æ˜¯å®ç°ä¸€ä¸ªçµæ´»çš„è¯åº“çƒ­åˆ·æ–°æœºåˆ¶ã€‚

è¦æ”¹é€ IKï¼Œç¬¬ä¸€æ­¥å½“ç„¶æ˜¯æ‹¿åˆ°å®ƒçš„æºç ã€‚[analysis-ik](https://github.com/infinilabs/analysis-ik)ã€‚ç„¶åç”¨é¡ºæ‰‹çš„Java IDEï¼ˆæ¯”å¦‚IntelliJ IDEAï¼‰æ‰“å¼€è¿™ä¸ªé¡¹ç›®ã€‚æ¥ä¸‹æ¥æ˜¯**é‡è¦**çš„ä¸€æ­¥ï¼š

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ”¹é€ è¯å…¸åŠ è½½é€»è¾‘ã€‚æ ¹æ®IKçš„æºç ç»“æ„ï¼Œæˆ‘ä»¬é‡ç‚¹è¦å…³æ³¨çš„æ˜¯è´Ÿè´£è¯å…¸ç®¡ç†å’ŒåŠ è½½çš„æ ¸å¿ƒç±»ã€‚é€šå¸¸ï¼Œè¿™ä¸ªå…³é”®è§’è‰²ä¼šè½åœ¨`org.wltea.analyzer.dic.Dictionary`è¿™ä¸ªç±»èº«ä¸Šã€‚å®ƒç®¡ç†ç€æ‰€æœ‰çš„è¯å…¸æ•°æ®ï¼ˆä¸»è¯å…¸ã€åœç”¨è¯è¯å…¸ç­‰ï¼‰ï¼Œå¹¶åœ¨IKåˆå§‹åŒ–å’Œè¿è¡Œæ—¶æä¾›è¯å…¸æŸ¥è¯¢æœåŠ¡ã€‚æˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯è®©å®ƒå­¦ä¼šä»æ•°æ®åº“â€œè¿›è´§â€ï¼Œå¹¶ä¸”è¿˜èƒ½å®šæœŸâ€œæ›´æ–°è´§æ¶â€ã€‚

## IKåˆ†è¯å™¨çš„è¯åº“çƒ­åˆ·æ–°æœºåˆ¶

æˆ‘ä»¬è¦ç©ä¸­æ–‡åˆ†è¯ï¼Œå…³é”®çš„ä¸€ç‚¹æ˜¯è¦æœ‰è¯åº“ï¼Œå¦‚æœè¯åº“ä¸€ç›´ä¸æ›´æ–°ï¼Œé‡Œé¢å°‘äº†ä¸€äº›å†·é—¨ï¼Œç½‘ç»œè¯è¯­ï¼Œæ¯”å¦‚â€œæ°´æ± é‡Œé¢é“¶é¾™é±¼â€ï¼Œ åˆ†è¯å™¨å°±ä¼šåˆ†è¯ä¸å‡†ç¡®ã€‚
IKä¸­æ–‡åˆ†è¯å™¨ï¼Œå°±å¿…é¡»è¦æ”¯æŒæˆ‘ä»¬ä»è‡ªå®šä¹‰çš„æ•°æ®åº“ä¸­åˆå§‹åŒ–çš„æ—¶å€™åŠ è½½è¯åº“ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè®©å®ƒå®šæ—¶ä»æ•°æ®åº“ä¸­åˆ·æ–°å’ŒåŠ è½½æœ€æ–°çš„è¯åº“ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æ›´æ–°è¯åº“çš„è¯ï¼Œå°±å¯ä»¥åœ¨webç•Œé¢æ‰‹åŠ¨å½•å…¥è¯è¯­ï¼Œæˆ–ç³»ç»ŸçŒå…¥æœ€æ–°çš„è¯æ±‡ï¼Œæ•°æ®åº“ï¼ŒES JVM è¿›ç¨‹é‡Œ -ã€‹IKä¸­æ–‡åˆ†è¯å™¨-ã€‹ä¸æ–­çš„è‡ªå·±çƒ­åŠ è½½æ•°æ®åº“é‡Œæœ€æ–°çš„è¯æ±‡å’Œçƒ­åˆ·æ–°ã€‚

## IKåˆ†è¯å™¨æºç æ”¹é€ æµç¨‹è®²è§£

okï¼Œå‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“äº†æˆ‘ä»¬è¦å®ç°ä»€ä¹ˆæ ·çš„æ•ˆæœï¼Œæœ¬èŠ‚æˆ‘ä»¬å°±æ¥åŠ¨æ‰‹æ”¹é€ ã€‚

éœ€è¦åˆ†æIKåˆ†è¯å™¨çš„æºç ç»“æ„ï¼Œç‰¹åˆ«æ˜¯ä¸è¯åº“åŠ è½½ç›¸å…³çš„éƒ¨åˆ†ï¼Œä»¥ä¾¿å®ç°ä»æ•°æ®åº“çƒ­åŠ è½½è¯åº“çš„åŠŸèƒ½ã€‚ä»é¡¹ç›®ç»“æ„å¯ä»¥çœ‹å‡ºï¼Œæ˜¯ä¸€ä¸ªMavené¡¹ç›®ï¼ˆå­˜åœ¨pom.xmlï¼‰ï¼Œä¸»è¦æœ‰`config`ã€`core`ã€`elasticsearch`å’Œ`opensearch`ç­‰ç›®å½•ã€‚

å…ˆäº†è§£IKåˆ†è¯å™¨çš„æ ¸å¿ƒå®ç°åœ¨å“ªé‡Œï¼Œç‰¹åˆ«æ˜¯ä¸è¯åº“åŠ è½½ç›¸å…³çš„ä»£ç ã€‚ä¸»è¦ä»£ç è·¯å¾„æ˜¯åœ¨ `analysis-ik/core/src/main/java/org/wltea/analyzer/dic` ç›®å½•ä¸‹ã€‚

éœ€è¦ç‰¹åˆ«å…³æ³¨`Dictionary.java`å’Œ`Monitor.java`æ–‡ä»¶ï¼Œå®ƒä»¬å¯èƒ½ä¸è¯å…¸ç®¡ç†å’Œç›‘æ§æœ‰å…³ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä»£ç ä½¿å…¶èƒ½å¤Ÿä»æ•°æ®åº“çƒ­åŠ è½½è¯åº“ã€‚

okï¼Œå…ˆåœ¨æ‰¾åˆ°äº†ä»£ç ï¼Œå†æ¥åˆ†æä¸‹éœ€æ±‚ï¼Œæ˜¯è®©IKåˆ†è¯å™¨æ”¯æŒä»æ•°æ®åº“ä¸­çƒ­åŠ è½½è¯åº“ã€‚ç›®å‰IKåˆ†è¯å™¨æ”¯æŒä»¥ä¸‹æ–¹å¼åŠ è½½è¯åº“ï¼š

* æœ¬åœ°æ–‡ä»¶åŠ è½½è¯å…¸
* è¿œç¨‹HTTPæ¥å£è·å–è¯å…¸ï¼ˆèƒ½å¤Ÿå®ç°çƒ­åŠ è½½ï¼‰

å¦‚ä½•å®ç°ä»æ•°æ®åº“ä¸­çƒ­åŠ è½½è¯åº“ï¼Œå³å®ç°æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ

* é¦–å…ˆéœ€è¦ï¼Œåˆ›å»ºæ•°æ®åº“è¿æ¥ç®¡ç†ç±»
* ä¿®æ”¹è¯å…¸åŠ è½½æœºåˆ¶ï¼Œå¢åŠ ä»æ•°æ®åº“åŠ è½½çš„æ–¹æ³•
* åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸä»æ•°æ®åº“ä¸­æ£€æŸ¥å¹¶æ›´æ–°è¯åº“ã€‚

```java
// åœ¨org.wltea.analyzer.dicåŒ…ä¸­åˆ›å»ºDBDictSource.java
package org.wltea.analyzer.dic;

import java.sql.*;
import java.util.ArrayList;
import java.util.List;
import org.apache.logging.log4j.Logger;
import org.wltea.analyzer.help.ESPluginLoggerFactory;

public class DBDictSource {

    private static final Logger logger = ESPluginLoggerFactory.getLogger(DBDictSource.class.getName());
    private String jdbcUrl;
    private String username;
    private String password;
    private String dictTableName;
    private String dictColumnName;
    private String lastUpdateTimeColumnName;
    private long lastUpdateTime;

    public DBDictSource(String jdbcUrl, String username, String password, String dictTableName, String dictColumnName, String lastUpdateTimeColumnName) {
        this.jdbcUrl = jdbcUrl;
        this.username = username;
        this.password = password;
        this.dictTableName = dictTableName;
        this.dictColumnName = dictColumnName;
        this.lastUpdateTimeColumnName = lastUpdateTimeColumnName;
        this.lastUpdateTime = 0L;
    }

    public Connection getConnection() throws SQLException {
        try {
            Class.forName("com.mysql.jdbc.Driver"); // æ ¹æ®å®é™…ä½¿ç”¨çš„æ•°æ®åº“ä¿®æ”¹é©±åŠ¨
            return DriverManager.getConnection(jdbcUrl, username, password);
        } catch (ClassNotFoundException e) {
            logger.error("Database driver not found", e);
            throw new SQLException("Database driver not found", e);
        }
    }

    public List<String> getNewDictWords() {
        List<String> words = new ArrayList<>();
        Connection conn = null;
        PreparedStatement ps = null;
        ResultSet rs = null;

        try {
            conn = getConnection();
            String sql = "SELECT " + dictColumnName + " FROM " + dictTableName;
            if (lastUpdateTimeColumnName != null && !lastUpdateTimeColumnName.isEmpty()) {
                sql += " WHERE " + lastUpdateTimeColumnName + " > ?";
                ps = conn.prepareStatement(sql);
                ps.setTimestamp(1, new Timestamp(lastUpdateTime));
            } else {
                ps = conn.prepareStatement(sql);
            }

            rs = ps.executeQuery();
            while (rs.next()) {
                String word = rs.getString(1);
                if (word != null && !word.trim().isEmpty()) {
                    words.add(word.trim());
                }
            }

            // æ›´æ–°æœ€åæ£€æŸ¥æ—¶é—´
            if (lastUpdateTimeColumnName != null && !lastUpdateTimeColumnName.isEmpty()) {
                sql = "SELECT MAX(" + lastUpdateTimeColumnName + ") FROM " + dictTableName;
                ps = conn.prepareStatement(sql);
                rs = ps.executeQuery();
                if (rs.next()) {
                    Timestamp maxTime = rs.getTimestamp(1);
                    if (maxTime != null) {
                        lastUpdateTime = maxTime.getTime();
                    }
                }
            }

            return words;
        } catch (SQLException e) {
            logger.error("Failed to load dictionary from database", e);
            return words;
        } finally {
            closeResources(conn, ps, rs);
        }
    }

    public List<String> getAllDictWords() {
        List<String> words = new ArrayList<>();
        Connection conn = null;
        PreparedStatement ps = null;
        ResultSet rs = null;

        try {
            conn = getConnection();
            String sql = "SELECT " + dictColumnName + " FROM " + dictTableName;
            ps = conn.prepareStatement(sql);
            rs = ps.executeQuery();

            while (rs.next()) {
                String word = rs.getString(1);
                if (word != null && !word.trim().isEmpty()) {
                    words.add(word.trim());
                }
            }

            return words;
        } catch (SQLException e) {
            logger.error("Failed to load dictionary from database", e);
            return words;
        } finally {
            closeResources(conn, ps, rs);
        }
    }

    private void closeResources(Connection conn, PreparedStatement ps, ResultSet rs) {
        try {
            if (rs != null) rs.close();
        } catch (SQLException e) {
            logger.error("Failed to close ResultSet", e);
        }

        try {
            if (ps != null) ps.close();
        } catch (SQLException e) {
            logger.error("Failed to close PreparedStatement", e);
        }

        try {
            if (conn != null) conn.close();
        } catch (SQLException e) {
            logger.error("Failed to close Connection", e);
        }
    }
}
```

ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œé…ç½®ç±»:

```xml
<!-- åœ¨IKAnalyzer.cfg.xmlä¸­æ·»åŠ æ•°æ®åº“é…ç½® -->
<properties>
    <!-- ç°æœ‰é…ç½®ä¿æŒä¸å˜ -->
    <!-- æ•°æ®åº“è¯åº“é…ç½® -->
    <entry key="db_enable">true</entry>
    <entry key="db_url">jdbc:mysql://localhost:3306/dict_db</entry>
    <entry key="db_username">root</entry>
    <entry key="db_password">password</entry>
    <entry key="db_dict_table">custom_dict</entry>
    <entry key="db_dict_column">word</entry>
    <entry key="db_time_column">update_time</entry>
    <entry key="db_poll_time">60</entry>
</properties>
```

```java
// åœ¨org.wltea.analyzer.cfg.Configurationç±»ä¸­æ·»åŠ æ–¹æ³•å’Œå±æ€§
private boolean dbEnable = false;
private String dbUrl;
private String dbUsername;
private String dbPassword;
private String dbDictTable;
private String dbDictColumn;
private String dbTimeColumn;
private int dbPollTime = 60; // é»˜è®¤60ç§’

// åœ¨åˆé€‚çš„åˆå§‹åŒ–æ–¹æ³•ä¸­æ·»åŠ 
public void loadConfig(Properties props) {
    // åŠ è½½ç°æœ‰é…ç½®

    // åŠ è½½æ•°æ®åº“é…ç½®
    dbEnable = Boolean.valueOf(props.getProperty("db_enable", "false"));
    if (dbEnable) {
        dbUrl = props.getProperty("db_url");
        dbUsername = props.getProperty("db_username");
        dbPassword = props.getProperty("db_password");
        dbDictTable = props.getProperty("db_dict_table");
        dbDictColumn = props.getProperty("db_dict_column");
        dbTimeColumn = props.getProperty("db_time_column");
        String pollTimeStr = props.getProperty("db_poll_time");
        if (pollTimeStr != null) {
            try {
                dbPollTime = Integer.parseInt(pollTimeStr);
            } catch (NumberFormatException e) {
                // ä½¿ç”¨é»˜è®¤å€¼
            }
        }
    }
}

// æ·»åŠ getteræ–¹æ³•
public boolean isDbEnable() {
    return dbEnable;
}

public String getDbUrl() {
    return dbUrl;
}

public String getDbUsername() {
    return dbUsername;
}

public String getDbPassword() {
    return dbPassword;
}

public String getDbDictTable() {
    return dbDictTable;
}

public String getDbDictColumn() {
    return dbDictColumn;
}

public String getDbTimeColumn() {
    return dbTimeColumn;
}

public int getDbPollTime() {
    return dbPollTime;
}
```

åˆ›å»ºæ•°æ®åº“è¯å…¸ç›‘æ§ç±»ï¼šå‚è€ƒç°æœ‰çš„Monitorç±»ï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¯å…¸ç›‘æ§ç±»ï¼š

```java
// åœ¨org.wltea.analyzer.dicåŒ…ä¸­åˆ›å»ºDBDictMonitor.java
package org.wltea.analyzer.dic;

import java.security.AccessController;
import java.security.PrivilegedAction;
import java.util.List;

import org.apache.logging.log4j.Logger;
import org.wltea.analyzer.cfg.Configuration;
import org.wltea.analyzer.help.ESPluginLoggerFactory;

public class DBDictMonitor implements Runnable {

    private static final Logger logger = ESPluginLoggerFactory.getLogger(DBDictMonitor.class.getName());

    private Configuration configuration;
    private DBDictSource dbDictSource;

    public DBDictMonitor(Configuration cfg) {
        this.configuration = cfg;
        if (cfg.isDbEnable()) {
            this.dbDictSource = new DBDictSource(
                cfg.getDbUrl(),
                cfg.getDbUsername(),
                cfg.getDbPassword(),
                cfg.getDbDictTable(),
                cfg.getDbDictColumn(),
                cfg.getDbTimeColumn()
            );
        }
    }

    @Override
    public void run() {
        configuration.check();
        AccessController.doPrivileged((PrivilegedAction<Void>) () -> {
            this.runUnprivileged();
            return null;
        });
    }

    public void runUnprivileged() {
        if (dbDictSource == null) {
            return;
        }

        try {
            logger.info("Checking database dictionary updates...");
            List<String> words = dbDictSource.getNewDictWords();

            if (words != null && !words.isEmpty()) {
                logger.info("Found {} new words in database, updating dictionary...", words.size());
                Dictionary.getSingleton().addWords(words);
                logger.info("Dictionary updated with words from database.");
            }
        } catch (Exception e) {
            logger.error("Error updating dictionary from database", e);
        }
    }

    // åˆå§‹åŒ–æ–¹æ³•ï¼Œä»æ•°æ®åº“åŠ è½½æ‰€æœ‰è¯æ¡
    public void loadAllDictWords() {
        if (dbDictSource == null) {
            return;
        }

        try {
            logger.info("Loading all dictionary words from database...");
            List<String> words = dbDictSource.getAllDictWords();

            if (words != null && !words.isEmpty()) {
                logger.info("Loaded {} words from database", words.size());
                Dictionary.getSingleton().addWords(words);
                logger.info("Dictionary initialized with words from database.");
            }
        } catch (Exception e) {
            logger.error("Error loading dictionary from database", e);
        }
    }
}
```

æ·»åŠ  MAVEN ä¾èµ–ï¼šåœ¨é¡¹ç›®çš„pom.xmlä¸­æ·»åŠ JDBCé©±åŠ¨ä¾èµ–ï¼Œæ¯”å¦‚MySQLçš„é©±åŠ¨

```xml
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.28</version>
</dependency>
```

éœ€è¦ç”¨æˆ·åœ¨æ•°æ®åº“ä¸­åˆ›å»ºç›¸åº”çš„è¡¨ç»“æ„ï¼š

```sql
CREATE TABLE custom_dict (
    id INT PRIMARY KEY AUTO_INCREMENT,
    word VARCHAR(100) NOT NULL,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

æˆ‘ä»¬éœ€è¦å¢åŠ ä¸€ç§æ–°çš„æ–¹å¼ï¼šä»æ•°æ®åº“ä¸­è¯»å–å¹¶çƒ­åŠ è½½è¯åº“ã€‚




åœç”¨è¯ï¼Œstop words å°±æ˜¯æ²¡æœ‰å¤ªå¤§æ„ä¹‰çš„ä¸€äº›è¯æ±‡ï¼Œåˆ†è¯å¯ä»¥å¿½ç•¥æ‰ã€‚ä¹Ÿæœ‰ä¸€ä¸ª

## åœ¨ESç”Ÿäº§é›†ç¾¤ä¸­å®‰è£…IKåˆ†è¯å™¨

æ”¹é€ å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡æ–°æ‰“åŒ…ï¼Œæ³¨æ„ç‰ˆæœ¬ã€‚æ‰§è¡Œå‘½ä»¤ï¼š

```bash
mvn clean package
```

å°±ä¼šå¾—åˆ°ä¸€ä¸ª jaråŒ…ï¼Œåé¢ç”¨è¿™ä¸ªjaråŒ…ï¼Œæ›¿æ¢æ‰IKå‘è¡Œç‰ˆæœ¬ä¸­çš„jaråŒ…ã€‚

ä¹‹åå»ºç«‹æ•°æ®åº“ä»¥åŠé…ç½®æ–‡ä»¶

æœ€åç»™3ä¸ªESèŠ‚ç‚¹éƒ½å®‰è£…IKåˆ†è¯å™¨ã€‚
å…ˆæç¬¬ä¸€å°æœºå™¨ã€‚
åœ¨elasticsearchçš„pluginsç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªikç›®å½•ï¼š

```bash
mkdir -p /app/elasticsearch/elasticsearch-7.9.3/plugins/ik
```

æŠŠä¸‹è½½çš„å‘è¡Œç‰ˆå‹ç¼©åŒ…ä¸Šä¼ åˆ°è¿™é‡Œã€‚ç„¶åè§£å‹

ç”¨åˆšåˆšæ‰“åŒ…å¥½çš„jaråŒ…æ›¿æ¢æ‰è§£å‹å¾—åˆ°çš„åŒåjaråŒ…ã€‚

æŠŠmysql-connector-java-8.0.20.jaråŒ…ä¹Ÿä¸Šä¼ åˆ°ikç›®å½•ã€‚ï¼ˆä¸ºä»€ä¹ˆï¼‰
åœ¨ik/configç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªjdbc.propertiesæ–‡ä»¶ã€‚

ç„¶åæç¬¬äºŒå°æœºå™¨ã€‚

é‡å¯esçš„ä¸‰ä¸ªèŠ‚ç‚¹ã€‚

ESç”Ÿäº§ç¯å¢ƒä¸‹ï¼ŒIKåˆ†è¯å™¨å’Œpinyinåˆ†è¯å™¨ä¸€å®šä¼šä¸€èµ·ä½¿ç”¨ã€‚