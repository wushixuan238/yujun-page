---
title: "ElasticSearchï¼ˆäºŒï¼‰ï¼šåˆ†åº“åˆ†è¡¨ä¸‹çš„å‡†å®æ—¶æœç´¢"  
category: "SD"  
publishedAt: "2025-06-03"  
summary: "ESå…¥é—¨ç³»åˆ—"  
tags:  
  - ES
banner: images/banner/posts/es/es-02.png
alt: "å›¾ç‰‡æ›¿ä»£æ–‡æœ¬"  
mathjax: false
---

# ElasticSearchï¼ˆäºŒï¼‰ï¼šåˆ†åº“åˆ†è¡¨ä¸‹çš„å‡†å®æ—¶æœç´¢ğŸš€

åœ¨ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•åœ¨å•ä½“MySQLç¯å¢ƒä¸‹é›†æˆElasticsearchæ„å»ºåŸºæœ¬çš„å•†å“æœç´¢åŠŸèƒ½ã€‚ç„¶è€Œï¼Œåœ¨çœŸå®çš„Cç«¯ï¼ˆé¢å‘æ¶ˆè´¹è€…ï¼‰åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡‡ç”¨**åˆ†åº“åˆ†è¡¨**çš„æ–¹æ¡ˆæ¥æ‰¿è½½å·¨å¤§çš„æ•°æ®æµé‡å’Œå­˜å‚¨å‹åŠ›ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¼šä»¥**ç”¨æˆ·ID**ä¸ºåˆ‡åˆ†é”®ï¼Œå°†ç”¨æˆ·çš„æŠ½å¥–è®¢å•ã€ç­¾åˆ°è®°å½•ç­‰è¡Œä¸ºæ•°æ®åˆ†æ•£åˆ°å„ä¸ªç‰©ç†åº“è¡¨ä¸­ã€‚

è¿™æ ·åšæå¤§åœ°æå‡äº†Cç«¯ç”¨æˆ·æœåŠ¡çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚ä½†æ˜¯ï¼Œæ–°çš„æŒ‘æˆ˜ä¹Ÿéšä¹‹è€Œæ¥ï¼šè¿è¥å›¢é˜Ÿéœ€è¦å¯¹å…¨é‡æ•°æ®è¿›è¡Œåˆ†æã€ç»Ÿè®¡å’ŒæŸ¥è¯¢ï¼Œä»¥åˆ¶å®šè¥é”€ç­–ç•¥ã€ç›‘æ§æ´»åŠ¨æ•ˆæœã€‚åˆ†åº“åˆ†è¡¨åï¼Œæ•°æ®æ•£è½åœ¨å„ä¸ªåº“ä¸­ï¼Œä¼ ç»Ÿçš„èšåˆæŸ¥è¯¢å˜å¾—å¼‚å¸¸å¤æ‚å’Œä½æ•ˆã€‚æˆ‘ä»¬æ€»ä¸èƒ½è½®è¯¢æ¯ä¸€ä¸ªåˆ†åº“åˆ†è¡¨å»ææ•°æ®å§ï¼Œé‚£æ ·æ•ˆç‡å°±å¾ˆæ…¢äº†ã€‚ğŸ˜«

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å¥—èƒ½å¤Ÿå°†è¿™äº›åˆ†æ•£æ•°æ®é‡æ–°èšåˆçš„æ–¹æ¡ˆã€‚è€Œ**Elasticsearch**å‡­å€Ÿå…¶å¼ºå¤§çš„èšåˆåˆ†æå’Œå…¨æ–‡æ£€ç´¢èƒ½åŠ›ï¼Œæˆä¸ºäº†ç†æƒ³çš„æ•°æ®å½’å®¿ã€‚å…³é”®åœ¨äºï¼Œå¦‚ä½•é«˜æ•ˆã€å‡†å®æ—¶åœ°å°†åˆ†åº“åˆ†è¡¨MySQLä¸­çš„æ•°æ®åŒæ­¥åˆ°Elasticsearchå‘¢ï¼Ÿ

å°±æ˜¯å¼•å…¥**å˜æ›´æ•°æ®æ•è· (Change Data Capture, CDC)** æŠ€æœ¯ï¼Œè€Œ **Canal** æ­£æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾ä¼˜ç§€çš„åŸºäºMySQLæ•°æ®åº“binlogçš„å¢é‡è®¢é˜…ä¸æ¶ˆè´¹ç»„ä»¶ã€‚æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨ **Canal Adapter** æ¥ç®€åŒ–æ•°æ®åŒæ­¥åˆ°Elasticsearchçš„è¿‡ç¨‹ã€‚

æœ¬ç¯‡åšå®¢ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦‚ä½•åœ¨ä¸€ä¸ªè¥é”€å¹³å°çš„èƒŒæ™¯ä¸‹ï¼Œæ„å»ºä¸€ä¸ª **åˆ†åº“åˆ†è¡¨MySQL -> Canal Server -> Canal Adapter -> Elasticsearch** çš„æ•°æ®åŒæ­¥é“¾è·¯ï¼Œå®ç°å‡†å®æ—¶çš„è¿è¥æ•°æ®æŸ¥è¯¢å’Œåˆ†æèƒ½åŠ›ã€‚

**ä½ å°†ä»æœ¬æ–‡å­¦åˆ°ï¼š**

* Cç«¯åœºæ™¯ä¸‹åˆ†åº“åˆ†è¡¨ï¼ˆæŒ‰ç”¨æˆ·IDåˆ‡åˆ†ï¼‰çš„å…¸å‹åº”ç”¨åŠå…¶å¸¦æ¥çš„æ•°æ®èšåˆéš¾é¢˜ã€‚
* Canalçš„æ ¸å¿ƒå·¥ä½œåŸç†åŠå…¶åœ¨CDCä¸­çš„å…³é”®è§’è‰²ã€‚
* Canal Adapterå¦‚ä½•ç®€åŒ–å°†binlogå˜æ›´åŒæ­¥åˆ°Elasticsearchçš„è¿‡ç¨‹ã€‚
* é’ˆå¯¹è¥é”€å¹³å°ç‰¹å®šåº“è¡¨ï¼ˆå¦‚`raffle_activity_order`, `user_raffle_order`ï¼‰çš„CanalåŠAdapteré…ç½®å®æˆ˜ã€‚
* å¦‚ä½•åœ¨Elasticsearchä¸­ä¸ºåŒæ­¥è¿‡æ¥çš„æ•°æ®åˆ›å»ºåˆé€‚çš„ç´¢å¼•å’ŒMappingã€‚
* é€šè¿‡Kibanaè¿›è¡Œæ•°æ®éªŒè¯å’Œç´¢å¼•æ¨¡å¼ç®¡ç†ã€‚
* å¦‚ä½•é€šè¿‡å®é™…ä¸šåŠ¡æ“ä½œï¼ˆå¦‚æ‰§è¡ŒæŠ½å¥–ã€ç­¾åˆ°ï¼‰æ¥è§¦å‘æ•°æ®åŒæ­¥å¹¶éªŒè¯å…¶æ•ˆæœã€‚

## ğŸ›ï¸ ç»„ä»¶ä»‹ç»ä¸æ•´ä½“æ¶æ„

### Canalï¼šæ•°æ®çš„â€œæ¬è¿å·¥â€ä¸â€œç¿»è¯‘å®˜â€

Canalï¼Œè¯‘ä¸ºæ°´é“/ç®¡é“/æ²Ÿæ¸ ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”å°±æ˜¯åŸºäºMySQLæ•°æ®åº“çš„å¢é‡æ—¥å¿—ï¼ˆbinlogï¼‰è¿›è¡Œè§£æï¼Œæä¾›å¢é‡æ•°æ®çš„è®¢é˜…å’Œæ¶ˆè´¹æœåŠ¡ã€‚

> æ—©åœ¨é˜¿é‡Œå·´å·´åˆæœŸï¼Œç”±äºæ­å·å’Œç¾å›½åŒæœºæˆ¿éƒ¨ç½²çš„éœ€æ±‚ï¼Œè·¨æœºæˆ¿æ•°æ®åŒæ­¥ä¸»è¦ä¾èµ–äºä¸šåŠ¡å±‚é¢çš„triggeræ¥è·å–å¢é‡å˜æ›´ã€‚ä»2010å¹´å¼€å§‹ï¼Œé˜¿é‡Œé€æ­¥è½¬å‘é€šè¿‡è§£ææ•°æ®åº“æ—¥å¿—æ¥è·å–å¢é‡å˜æ›´ï¼Œä»è€Œå‚¬ç”Ÿäº†å¤§é‡çš„æ•°æ®åº“å¢é‡è®¢é˜…å’Œæ¶ˆè´¹ä¸šåŠ¡ï¼ŒCanalä¾¿æ˜¯è¿™ä¸€èƒŒæ™¯ä¸‹çš„æ°å‡ºäº§ç‰©ã€‚

**å®ƒçš„å·¥ä½œåŸç†å…¶å®å¾ˆå·§å¦™ï¼š**
Canalä¼šæ¨¡æ‹Ÿä¸€ä¸ªMySQLçš„ä»åº“ï¼ˆslaveï¼‰çš„äº¤äº’åè®®ï¼Œå‘MySQLä¸»åº“ï¼ˆmasterï¼‰å‘é€`dump`åè®®è¯·æ±‚ã€‚å½“MySQLä¸»åº“æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œä¾¿ä¼šå¼€å§‹å°†äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinary logï¼‰æ¨é€ç»™è¿™ä¸ªâ€œä¼ªè£…â€çš„ä»åº“ï¼Œä¹Ÿå°±æ˜¯Canal Serverã€‚Canal Serveræ¥æ”¶åˆ°binlogåï¼Œä¼šå¯¹å…¶è¿›è¡Œè§£æï¼Œæå–å‡ºç»“æ„åŒ–çš„æ•°æ®å˜æ›´äº‹ä»¶ï¼ˆINSERT, UPDATE, DELETEï¼‰ï¼Œç„¶åæ ¹æ®é…ç½®å°†è¿™äº›å˜æ›´åˆ†å‘å‡ºå»ã€‚

### Canal Adapterï¼šç›´è¾¾ESçš„â€œç‰¹å¿«ä¸“é€’â€

è™½ç„¶Canal Serverè´Ÿè´£æ•è·å’Œè§£æbinlogï¼Œä½†å¦‚ä½•å°†è¿™äº›å˜æ›´æ•°æ®é«˜æ•ˆã€æ­£ç¡®åœ°å†™å…¥ç›®æ ‡å­˜å‚¨ï¼ˆå¦‚Elasticsearchï¼‰å‘¢ï¼Ÿè¿™æ—¶ï¼ŒCanal Adapterå°±æ´¾ä¸Šç”¨åœºäº†ã€‚Canal Adapteræ˜¯Canalç”Ÿæ€ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œå®ƒå¯ä»¥æ¶ˆè´¹Canal Serverè§£æåçš„æ•°æ®ï¼Œå¹¶æ ¹æ®é¢„è®¾çš„é€‚é…å™¨ï¼ˆAdapterï¼‰é…ç½®ï¼Œå°†æ•°æ®å†™å…¥åˆ°å„ç§ç›®æ ‡æ•°æ®æºï¼ŒåŒ…æ‹¬Elasticsearchã€HBaseã€Kafkaã€RocketMQç­‰ã€‚

å¯¹äºæˆ‘ä»¬çš„åœºæ™¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Canal Adapterçš„**ESé€‚é…å™¨**ï¼Œå®ƒå¯ä»¥ç›´æ¥å°†æ•°æ®å˜æ›´åŒæ­¥åˆ°Elasticsearchä¸­ï¼Œçœå»äº†æˆ‘ä»¬è‡ªå·±ç¼–å†™å¤æ‚æ¶ˆè´¹ç«¯é€»è¾‘çš„éº»çƒ¦ã€‚

### æ•´ä½“æ¶æ„å›¾

```
+---------------------+     +---------------------+     +-----------------------+     +-------------------+
|                     |     |                     |     |                       |     |                   |
|  MySQLåˆ†ç‰‡é›†ç¾¤      | --> |    Canal Server     | --> |     Canal Adapter     | --> |   Elasticsearch   |
| (big_market_01,    |     | (è®¢é˜…Binlog)        |     | (ESé€‚é…å™¨, åŒæ­¥æ•°æ®)  |     | (ç»Ÿä¸€ç´¢å¼•)        |
|  big_market_02)     |     |                     |     |                       |     |                   |
+---------------------+     +---------------------+     +-----------------------+     +-------------------+
        ^                                                                                       |
        |                                                                                       |
        |  (åº”ç”¨å±‚é€šè¿‡åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶å†™å…¥/è¯»å– - ç”¨æˆ·è¡Œä¸º)                                           | (è¿è¥ä¾§æŸ¥è¯¢/åˆ†æ)
        +---------------------------------------------------------------------------------------+
```

**ä»¥ä¸Šæ•°æ®æµè½¬çš„æ ¸å¿ƒé€»è¾‘ï¼š**

1. ç”¨æˆ·åœ¨è¥é”€å¹³å°è¿›è¡ŒæŠ½å¥–ã€ç­¾åˆ°ç­‰æ“ä½œï¼Œæ•°æ®é€šè¿‡åˆ†åº“åˆ†è¡¨è§„åˆ™å†™å…¥åˆ°ä¾‹å¦‚ `big_market_01.raffle_activity_order_00` æˆ– `big_market_02.user_raffle_order_01` ç­‰å…·ä½“çš„MySQLåˆ†ç‰‡è¡¨ä¸­ã€‚
2. MySQLäº§ç”Ÿbinlogè®°å½•è¿™äº›æ•°æ®å˜æ›´ã€‚
3. Canal Serverè®¢é˜…è¿™äº›MySQLå®ä¾‹çš„binlogï¼Œè§£æå‡ºç»“æ„åŒ–çš„å˜æ›´äº‹ä»¶ã€‚
4. Canal Adapterè¿æ¥åˆ°Canal Serverï¼Œè·å–è¿™äº›å˜æ›´äº‹ä»¶ã€‚
5. Canal Adapteræ ¹æ®å…¶ESé€‚é…å™¨çš„é…ç½®ï¼ˆæ¯”å¦‚å“ªä¸ªåº“çš„å“ªä¸ªè¡¨å¯¹åº”ESçš„å“ªä¸ªç´¢å¼•ï¼Œå­—æ®µå¦‚ä½•æ˜ å°„ç­‰ï¼‰ï¼Œå°†æ•°æ®è‡ªåŠ¨åŒæ­¥åˆ°Elasticsearchä¸­ã€‚
6. è¿è¥äººå‘˜é€šè¿‡Kibanaæˆ–å†…éƒ¨æ•°æ®å¹³å°æŸ¥è¯¢Elasticsearchï¼Œè·å–èšåˆåçš„å…¨é‡æ•°æ®è¿›è¡Œåˆ†æã€‚


## ğŸ¯ åŠŸèƒ½é¢„æœŸ

æœ¬æ¬¡å®æˆ˜ï¼Œæˆ‘ä»¬å°†é‡ç‚¹é€‰å¤§è¥é”€å¹³å°çš„ `big_market_01` å’Œ `big_market_02` ä¸¤ä¸ªåˆ†åº“ä¸­çš„ `raffle_activity_order` å’Œ `user_raffle_order` ç›¸å…³åˆ†ç‰‡è¡¨ï¼ˆå‡è®¾å®ƒä»¬æ˜¯æŒ‰æŸç§è§„åˆ™åˆ†ç‰‡çš„ï¼Œä¾‹å¦‚ `raffle_activity_order_xx`ï¼‰è¿›è¡ŒElasticsearchåŒæ­¥é…ç½®ã€‚é€šè¿‡å­¦ä¹ è¿™ä¸ªè¿‡ç¨‹ï¼Œä½ å¯ä»¥è§¦ç±»æ—é€šï¼Œä¸ºé¡¹ç›®ä¸­å…¶ä»–çš„åº“è¡¨é…ç½®åŒæ­¥ã€‚

## ğŸ› ï¸ ç¯å¢ƒå®‰è£…ä¸é…ç½®

> **ç¯å¢ƒè„šæœ¬è¯´æ˜ï¼š** å‡è®¾æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†åŒ…å«Canalã€Canal Adapterã€Kibanaã€Logstashï¼ˆå¦‚æœç”¨åˆ°ï¼‰ä»¥åŠDocker Compose è„šæœ¬æ–‡ä»¶çš„å·¥ç¨‹ç¯å¢ƒã€‚æˆ‘ä»¬è¿™é‡Œé‡ç‚¹å…³æ³¨ä¸æ•°æ®åŒæ­¥ç›¸å…³çš„é…ç½®ã€‚

### 1. MySQLä¾§å‡†å¤‡

* **å¼€å¯Binlogï¼š**
  ç¡®ä¿ä½ çš„æ‰€æœ‰MySQLåˆ†ç‰‡å®ä¾‹ï¼ˆä¾‹å¦‚ `big_market_01` å’Œ `big_market_02` æ‰€åœ¨çš„MySQLæœåŠ¡ï¼‰éƒ½å·²ç»å¼€å¯äº†binlogï¼Œå¹¶ä¸”binlogæ ¼å¼ä¸º `ROW`ã€‚
  åœ¨MySQLçš„é…ç½®æ–‡ä»¶ (`my.cnf` æˆ– `my.ini`) ä¸­æ£€æŸ¥æˆ–æ·»åŠ ï¼š

    ```ini
    [mysqld]
    log-bin=mysql-bin
    binlog_format=ROW
    server-id=XXX  # æ¯ä¸ªMySQLå®ä¾‹çš„server-idå¿…é¡»å…¨å±€å”¯ä¸€
    ```

  é‡å¯MySQLä½¿é…ç½®ç”Ÿæ•ˆã€‚
* **åˆ›å»ºCanalè¿æ¥è´¦æˆ·ï¼š**
  ä¸ºCanalåˆ›å»ºä¸€ä¸ªä¸“ç”¨çš„MySQLè´¦æˆ·ï¼Œå¹¶æˆäºˆå¿…è¦çš„å¤åˆ¶æƒé™ (REPLICATION SLAVE, REPLICATION CLIENT)ã€‚

    ```sql
    CREATE USER 'canal'@'%' IDENTIFIED BY 'your_canal_password';
    GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'canal'@'%';
    FLUSH PRIVILEGES;
    ```

### 2. Canal Server é…ç½®

Canal Serveréœ€è¦çŸ¥é“å®ƒåº”è¯¥å»ç›‘å¬å“ªäº›MySQLå®ä¾‹ã€‚è¿™é€šå¸¸åœ¨ `canal.properties` å’Œå„ä¸ª `destination` çš„ `instance.properties` ä¸­é…ç½®ã€‚

* **`conf/canal.properties`**:
  ç¡®ä¿ `canal.serverMode = tcp` (å› ä¸ºAdapterä¼šé€šè¿‡TCPè¿æ¥Server)ã€‚

  ```properties
  canal.port = 11111
  canal.serverMode = tcp
  # ... å…¶ä»–é…ç½®
  ```
* **`conf/<destination_name>/instance.properties`**:
  æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªè¦ç›‘å¬çš„MySQL**å®ä¾‹**ï¼ˆä¸æ˜¯æ¯ä¸ªåº“ï¼Œå¦‚æœå¤šä¸ªåº“åœ¨åŒä¸€ä¸ªMySQLå®ä¾‹ä¸Šï¼Œä¸€ä¸ªdestinationå°±å¤Ÿäº†ï¼Œé€šè¿‡filteræ¥åŒºåˆ†åº“è¡¨ï¼‰é…ç½®ä¸€ä¸ªdestinationã€‚
  ä¾‹å¦‚ï¼Œå¦‚æœ `big_market_01` å’Œ `big_market_02` æ˜¯ä¸¤ä¸ªä¸åŒçš„MySQLå®ä¾‹ï¼Œä½ éœ€è¦ä¸¤ä¸ªdestinationã€‚å¦‚æœå®ƒä»¬åœ¨åŒä¸€ä¸ªMySQLå®ä¾‹ä¸Šï¼Œä½†ä½ æƒ³åˆ†å¼€ç®¡ç†æˆ–è¿‡æ»¤ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸¤ä¸ªã€‚

  å‡è®¾ä¸º `big_market_01` åˆ›å»º `conf/bm_db01/instance.properties`:

  ```properties
  canal.instance.master.address = host_of_big_market_01_mysql:3306
  canal.instance.dbUsername = canal
  canal.instance.dbPassword = your_canal_password
  # ç›‘å¬big_market_01åº“ä¸‹æ‰€æœ‰raffle_activity_order_xx å’Œ user_raffle_order_xx è¡¨
  canal.instance.filter.regex = big_market_01\\.raffle_activity_order_\\d+,big_market_01\\.user_raffle_order_\\d+
  # å¦‚æœè¡¨åæ²¡æœ‰è§„å¾‹çš„åç¼€ï¼Œè€Œæ˜¯å®Œå…¨ä¸åŒçš„è¡¨åï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”
  # canal.instance.filter.regex = big_market_01\\.tableA,big_market_01\\.tableB
  ```

  ç±»ä¼¼åœ°ï¼Œä¸º `big_market_02` åˆ›å»º `conf/bm_db02/instance.properties`ã€‚

### 3. Canal Adapter é…ç½® (æ ¸å¿ƒï¼)

Canal Adapterè´Ÿè´£å°†ä»Canal Serverè·å–çš„æ•°æ®åŒæ­¥åˆ°Elasticsearchã€‚å®ƒçš„é…ç½®ä¸»è¦æ¶‰åŠï¼š

* **`conf/application.yml` (Adapterçš„ä¸»é…ç½®æ–‡ä»¶):**
  è¿™é‡Œéœ€è¦é…ç½®Adapterè¦è¿æ¥çš„Canal Serveråœ°å€ã€è¦å¤„ç†çš„`destination`ï¼Œä»¥åŠå…¨å±€çš„ESè¿æ¥ä¿¡æ¯ã€‚

    ```yaml
    canalAdapters:
      - instance: bm_db01 # å¯¹åº”Canal Serverä¸­çš„destinationåç§°
        # sourceConnector: # Canal Serverè¿æ¥ä¿¡æ¯ï¼Œå¦‚æœAdapterå’ŒServeråœ¨åŒä¸€éƒ¨ç½²ï¼Œå¾ˆå¤šå¯ä»¥é»˜è®¤
        #   type: canal # æˆ– rds ...
        #   properties:
        #     canal.server.host: localhost # Canal Serverçš„ä¸»æœºï¼Œå¦‚æœæ˜¯Dockerç½‘ç»œï¼Œå¯èƒ½æ˜¯canal-serverå®¹å™¨å
        #     canal.server.port: 11111
        #     canal.destination: bm_db01
        #     canal.user: ""
        #     canal.passwd: ""
        groups:
          - groupId: g1
            outerAdapters: # é…ç½®å¤–éƒ¨é€‚é…å™¨ï¼Œå³ç›®æ ‡æ•°æ®æº
              - name: es7 # æŒ‡å®šä½¿ç”¨es7çš„é€‚é…å™¨ (ç¡®ä¿ä½ çš„Adapterç‰ˆæœ¬æ”¯æŒes7)
                mode: sync # åŒæ­¥æ¨¡å¼
                properties:
                  # ESè¿æ¥ä¿¡æ¯
                  elasticsearch.hosts: elasticsearch:9200 # Dockerç½‘ç»œä¸­çš„ESæœåŠ¡åå’Œç«¯å£
                  # elasticsearch.username: # å¦‚æœESæœ‰è®¤è¯
                  # elasticsearch.password:
                  # elasticsearch.cluster.name: # å¦‚æœæœ‰é›†ç¾¤å
      - instance: bm_db02 # ç¬¬äºŒä¸ªdestinationçš„é…ç½®ï¼Œç±»ä¼¼bm_db01
        # ...
        groups:
          - groupId: g1
            outerAdapters:
              - name: es7
                mode: sync
                properties:
                  elasticsearch.hosts: elasticsearch:9200
    # ... å…¶ä»–Adapterå…¨å±€é…ç½®
    ```
* **åº“è¡¨åŒæ­¥æ˜ å°„é…ç½® (YMLæ–‡ä»¶)ï¼š**
  æ ¹æ®ä½ çš„åšæ–‡æè¿°ï¼Œéœ€è¦åœ¨Canal Adapterçš„ `conf/es7/` ç›®å½•ä¸‹ï¼ˆæˆ–è€…ä½ æŒ‡å®šçš„ESé€‚é…å™¨å¯¹åº”çš„é…ç½®ç›®å½•ï¼‰ä¸ºæ¯ä¸ªéœ€è¦åŒæ­¥çš„**é€»è¾‘è¡¨**ï¼ˆå³ä½¿å®ƒåœ¨MySQLä¸­æ˜¯åˆ†ç‰‡è¡¨ï¼‰åˆ›å»ºä¸€ä¸ªYMLé…ç½®æ–‡ä»¶ã€‚è¿™ä¸ªYMLæ–‡ä»¶å®šä¹‰äº†ä»MySQLè¡¨åˆ°ESç´¢å¼•çš„æ˜ å°„å…³ç³»ã€ä¸»é”®ã€å­—æ®µæ˜ å°„ç­‰ã€‚

  ä¾‹å¦‚ï¼Œä¸º `raffle_activity_order` (é€»è¾‘è¡¨åï¼Œå®ƒå¯èƒ½å¯¹åº”MySQLä¸­çš„ `big_market_01.raffle_activity_order_xx` å’Œ `big_market_02.raffle_activity_order_yy`) åˆ›å»º `conf/es7/big_market_raffle_activity_order.yml`:

    ```yaml
    # æ•°æ®æºä¿¡æ¯ (Adapterä¼šæ ¹æ®è¿™ä¸ªä¿¡æ¯åŒ¹é…Canal Serverä¼ æ¥çš„æ•°æ®)
    dataSourceKey: defaultDS # é»˜è®¤ï¼Œæˆ–ä¸application.ymlä¸­é…ç½®çš„å¯¹åº”
    destination: bm_db01 # è¿™ä¸ªé…ç½®å±äºå“ªä¸ªdestinationï¼Œæˆ–è€…å¯ä»¥é…ç½®ä¸ºç›‘å¬æ‰€æœ‰
    groupId: g1
    # é€»è¾‘è¡¨åï¼ŒAdapterä¼šç”¨è¿™ä¸ªåå­—å»åŒ¹é…Canal Serveräº‹ä»¶ä¸­çš„è¡¨åï¼ˆå¯èƒ½éœ€è¦æ­£åˆ™æˆ–é€šé…ç¬¦ï¼‰
    # æˆ–è€…ï¼Œæ›´å¸¸è§çš„æ˜¯ï¼Œè¿™é‡Œçš„ table å­—æ®µç›´æ¥æŒ‡å®šäº†è¦åŒæ­¥åˆ°ESçš„ç´¢å¼•åï¼Œ
    # è€Œå…·ä½“çš„MySQLè¡¨ååŒ¹é…è§„åˆ™åœ¨æ›´ä¸Šå±‚çš„Adapteré…ç½®æˆ–é€šè¿‡canal.instance.filter.regexæ¥å¤„ç†ã€‚
    # Canal Adapterçš„YMLé…ç½®ç»†èŠ‚è¾ƒå¤šï¼Œå…·ä½“å­—æ®µåå’Œç»“æ„è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚
    # è¿™é‡Œæ˜¯ä¸€ä¸ªç®€åŒ–çš„æ¦‚å¿µï¼Œå®é™…YMLå¯èƒ½æ›´å¤æ‚ã€‚
    
    # ç®€åŒ–çš„YMLç¤ºä¾‹ï¼Œæ›´å‡†ç¡®çš„é…ç½®è¯·æŸ¥é˜…Canal Adapteræ–‡æ¡£
    # é€šå¸¸YMLæ–‡ä»¶åä¼šæ˜¯ database-table.yml æˆ–ç±»ä¼¼æ ¼å¼ï¼ŒAdapterä¼šåŠ è½½å®ƒä»¬
    # å‡è®¾YMLæ–‡ä»¶åç›´æ¥å¯¹åº”ESçš„ç´¢å¼•åï¼Œæˆ–è€…åœ¨å†…éƒ¨æŒ‡å®š
    # File: conf/es7/big_market_raffle_activity_order.yml
    elasticsearch:
      # ESç´¢å¼•åï¼Œå°†æ‰€æœ‰åˆ†ç‰‡è¡¨çš„raffle_activity_orderæ•°æ®åŒæ­¥åˆ°è¿™ä¸ªç»Ÿä¸€ç´¢å¼•
      index: big_market.raffle_activity_order
      # idå¯¹åº”MySQLè¡¨ä¸­çš„ä¸»é”®å­—æ®µåï¼Œç”¨äºESæ–‡æ¡£çš„_id
      # å¦‚æœæ˜¯è”åˆä¸»é”®ï¼Œå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†æˆ–è‡ªå®šä¹‰ç”Ÿæˆç­–ç•¥
      pk: _order_id # å‡è®¾MySQLè¡¨ä¸­çš„ä¸»é”®æ˜¯ order_idï¼ŒåŒæ­¥åˆ°ESæ—¶å­—æ®µåä¸º _order_id
      # ï¼ˆæ³¨æ„ï¼šAdapterçš„YMLé…ç½®ä¸­ï¼Œå­—æ®µåå¯èƒ½ä¸éœ€è¦å‰ç¼€ "_" , å®ƒä¼šè‡ªåŠ¨å¤„ç†æˆ–æ ¹æ®é…ç½®æ·»åŠ ï¼‰
      # mapping: # å¯é€‰ï¼Œå¦‚æœESç´¢å¼•çš„mappingä¸æ˜¯è‡ªåŠ¨åˆ›å»ºæˆ–éœ€è¦æ›´ç²¾ç»†æ§åˆ¶
      #   fields:
      //         - column: order_id
      //           name: _order_id
      //           type: keyword
      //         - column: user_id
      //           name: _user_id
      //           type: keyword
      //         ... å…¶ä»–å­—æ®µæ˜ å°„
    ```

  éœ€è¦ä¸º `user_raffle_order` ä¹Ÿåˆ›å»ºä¸€ä¸ªç±»ä¼¼çš„YMLé…ç½®æ–‡ä»¶ã€‚
  **é‡è¦ï¼šCanal Adapterçš„YMLé…ç½®æ–‡ä»¶æ ¼å¼å’Œå…·ä½“å­—æ®µéå¸¸å…³é”®ï¼Œå¼ºçƒˆå»ºè®®æŸ¥é˜…ä½ æ‰€ä½¿ç”¨çš„Canal Adapterç‰ˆæœ¬çš„å®˜æ–¹æ–‡æ¡£æ¥è·å–å‡†ç¡®çš„é…ç½®æ–¹æ³•ã€‚** ä¸Šè¿°YMLä»…ä¸ºç¤ºæ„ã€‚

### 4. è¿è¡ŒçŠ¶æ€æ£€æŸ¥

* ç¡®ä¿MySQLã€Canal Serverã€Canal Adapterã€Elasticsearchã€Kibanaéƒ½å·²å¯åŠ¨ã€‚
* ä½¿ç”¨Portaineræˆ–Dockeræ—¥å¿—å‘½ä»¤ (`docker logs <container_name>`) æŸ¥çœ‹å„ä¸ªç»„ä»¶çš„è¿è¡Œæ—¥å¿—ï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯ï¼Œç‰¹åˆ«æ˜¯ï¼š
   * Canal Serveræ˜¯å¦æˆåŠŸè¿æ¥åˆ°æ‰€æœ‰MySQLå®ä¾‹å¹¶å¼€å§‹æ‹‰å–binlogã€‚
   * Canal Adapteræ˜¯å¦æˆåŠŸè¿æ¥åˆ°Canal Serverå¹¶è·å–åˆ°`destination`çš„æ•°æ®ã€‚
   * Canal Adapteræ˜¯å¦æˆåŠŸè¿æ¥åˆ°Elasticsearchã€‚
   * Canal Adapteråœ¨å¤„ç†æ•°æ®æ—¶æ˜¯å¦æœ‰é”™è¯¯ï¼ˆä¾‹å¦‚YMLé…ç½®é”™è¯¯ã€å­—æ®µæ˜ å°„é—®é¢˜ã€ESå†™å…¥æƒé™é—®é¢˜ç­‰ï¼‰ã€‚

## ğŸ”® ESç´¢å¼•åˆ›å»ºä¸æ•°æ®éªŒè¯

### 1. åˆ›å»ºESç´¢å¼• (æ‰‹åŠ¨æˆ–é€šè¿‡Adapterè‡ªåŠ¨åˆ›å»º)

* **æ‰‹åŠ¨åˆ›å»º (é€šè¿‡cURLæˆ–Kibana Dev Tools):**
  åœ¨æ•°æ®åŒæ­¥å¼€å§‹å‰ï¼Œæˆ–è€…å¦‚æœAdapteré…ç½®ä¸ºä¸è‡ªåŠ¨åˆ›å»ºç´¢å¼•ï¼Œä½ éœ€è¦æ‰‹åŠ¨åˆ›å»ºESç´¢å¼•å¹¶å®šä¹‰å¥½Mappingã€‚è¿™èƒ½è®©ä½ å¯¹å­—æ®µç±»å‹ï¼ˆ`text`, `keyword`, `date`, `long`ç­‰ï¼‰æœ‰æ›´ç²¾ç¡®çš„æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦åˆ†è¯çš„æ–‡æœ¬å­—æ®µå’Œéœ€è¦ç²¾ç¡®åŒ¹é…æˆ–èšåˆçš„keywordå­—æ®µã€‚

  **big_market.raffle_activity_order ç´¢å¼•åˆ›å»º (ä½¿ç”¨æä¾›çš„cURL):**

  ```shell
  curl -X PUT "http://127.0.0.1:9200/big_market.raffle_activity_order" -H 'Content-Type: application/json' -d'
  {
      "mappings": {
        "properties": {
          "_user_id":{"type": "keyword"},
          "_sku":{"type": "keyword"},
          "_activity_id":{"type": "keyword"},
          "_activity_name":{"type": "text", "analyzer": "ik_smart"},
          "_strategy_id":{"type": "keyword"},
          "_order_id":{"type": "keyword"},
          "_order_time":{"type": "date", "format": "yyyy-MM-dd HH:mm:ss||epoch_millis"},
          "_total_count":{"type": "integer"},
          "_day_count":{"type": "integer"},
          "_month_count":{"type": "integer"},
          "_pay_amount":{"type": "double"},
          "_state":{"type": "keyword"},
          "_out_business_no":{"type": "keyword"},
          "_create_time":{"type": "date", "format": "yyyy-MM-dd HH:mm:ss||epoch_millis"},
          "_update_time":{"type": "date", "format": "yyyy-MM-dd HH:mm:ss||epoch_millis"}
        }
      }
  }'
  ```

  **big_market.user_raffle_order ç´¢å¼•åˆ›å»º (ä½¿ç”¨æä¾›çš„cURL):**

  ```shell
  curl -X PUT "http://127.0.0.1:9200/big_market.user_raffle_order" -H 'Content-Type: application/json' -d'
  {
      "mappings": {
        "properties": {
          "_user_id":{"type": "keyword"},
          "_activity_id":{"type": "keyword"},
          "_activity_name":{"type": "text", "analyzer": "ik_smart"},
          "_strategy_id":{"type": "keyword"},
          "_order_id":{"type": "keyword"},
          "_order_time":{"type": "date", "format": "yyyy-MM-dd HH:mm:ss||epoch_millis"},
          "_order_state":{"type": "keyword"},
          "_create_time":{"type": "date", "format": "yyyy-MM-dd HH:mm:ss||epoch_millis"},
          "_update_time":{"type": "date", "format": "yyyy-MM-dd HH:mm:ss||epoch_millis"}
        }
      }
  }'
  ```

  **æ³¨æ„æˆ‘å¯¹Mappingçš„å»ºè®®æ€§ä¿®æ”¹ï¼š**

   * `_user_id`, `_activity_id`, `_order_id` ç­‰IDç±»å­—æ®µé€šå¸¸ç”¨ `keyword` ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬ç”¨äºç²¾ç¡®åŒ¹é…ã€è¿‡æ»¤æˆ–èšåˆï¼Œä¸éœ€è¦åˆ†è¯ã€‚
   * `_activity_name` è¿™ç§å¯èƒ½éœ€è¦æ¨¡ç³Šæœç´¢çš„æ–‡æœ¬å­—æ®µç”¨ `text` ç±»å‹ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªåˆé€‚çš„åˆ†è¯å™¨ (å¦‚ `ik_smart` æˆ– `ik_max_word`ï¼Œå‰ææ˜¯ä½ çš„ESå·²å®‰è£…IKåˆ†è¯å™¨)ã€‚
   * `_order_time`, `_create_time`, `_update_time` ç­‰æ—¶é—´å­—æ®µç”¨ `date` ç±»å‹ï¼Œå¹¶å¯ä»¥æŒ‡å®š `format` (å¤šç§æ ¼å¼ç”¨ `||` åˆ†éš”ï¼Œ`epoch_millis` è¡¨ç¤ºæ¯«ç§’æ—¶é—´æˆ³)ã€‚
   * æ•°å€¼å‹å­—æ®µï¼ˆå¦‚count, amountï¼‰åº”ä½¿ç”¨ `integer`, `long`, `double`, `float` ç­‰æ•°å€¼ç±»å‹ã€‚
   * çŠ¶æ€ã€ç±»å‹ç­‰æšä¸¾æ€§è´¨çš„å­—æ®µç”¨ `keyword`ã€‚
   * **ä½ æä¾›çš„Mappingä¸­æ‰€æœ‰å­—æ®µéƒ½æ˜¯ `text`ï¼Œè¿™å¯¹äºéæ–‡æœ¬å­—æ®µï¼ˆå¦‚IDã€æ—¥æœŸã€æ•°å­—ï¼‰æ¥è¯´æ˜¯ä¸åˆé€‚çš„ï¼Œä¼šå½±å“æœç´¢ã€æ’åºå’Œèšåˆçš„å‡†ç¡®æ€§å’Œæ€§èƒ½ã€‚è¯·åŠ¡å¿…æ ¹æ®å­—æ®µçš„å®é™…å«ä¹‰è°ƒæ•´ç±»å‹ã€‚**
* **Adapterè‡ªåŠ¨åˆ›å»ºï¼š**
  æŸäº›ç‰ˆæœ¬çš„Canal Adapteræˆ–å…¶ESé€‚é…å™¨å¯èƒ½æ”¯æŒæ ¹æ®YMLé…ç½®æˆ–æºè¡¨ç»“æ„è‡ªåŠ¨åˆ›å»ºç´¢å¼•å’ŒåŸºç¡€çš„Mappingã€‚ä½†è¿™é€šå¸¸ä¸å¦‚æ‰‹åŠ¨ç²¾ç»†æ§åˆ¶Mappingæ¥å¾—å¥½ã€‚å¦‚æœä¾èµ–è‡ªåŠ¨åˆ›å»ºï¼Œè¯·åŠ¡å¿…æ£€æŸ¥ç”Ÿæˆçš„Mappingæ˜¯å¦ç¬¦åˆä½ çš„é¢„æœŸã€‚

### 2. åœ¨Kibanaä¸­åˆ›å»ºç´¢å¼•æ¨¡å¼ (Index Pattern / Data View)

* æ‰“å¼€Kibana (`http://127.0.0.1:5601`)ã€‚
* å¯¼èˆªåˆ° "Stack Management" -> "Index Patterns" (æˆ– "Data Views")ã€‚
* ç‚¹å‡» "Create index pattern"ã€‚
* **è¾“å…¥ç´¢å¼•æ¨¡å¼åç§°ï¼š**
   * å¯¹äº `big_market.raffle_activity_order` ç´¢å¼•ï¼Œå°±è¾“å…¥ `big_market.raffle_activity_order`ã€‚
   * å¯¹äº `big_market.user_raffle_order` ç´¢å¼•ï¼Œå°±è¾“å…¥ `big_market.user_raffle_order`ã€‚
   * (æˆ–è€…ï¼Œå¦‚æœä½ æƒ³ç”¨ä¸€ä¸ªæ¨¡å¼åŒ¹é…å¤šä¸ªç›¸å…³çš„ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œä¾‹å¦‚ `big_market.*_order`ã€‚)
* **é€‰æ‹©æ—¶é—´å­—æ®µï¼š** é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ—¶é—´å­—æ®µï¼Œå¦‚ `_create_time` æˆ– `_order_time`ã€‚
* ç‚¹å‡» "Create index pattern"ã€‚

### 3. è§¦å‘æ•°æ®å˜æ›´å¹¶éªŒè¯åŒæ­¥

ç°åœ¨ï¼Œç¯å¢ƒå’Œé…ç½®éƒ½å·²å°±ç»ªï¼Œå°±å¯ä»¥éªŒè¯æˆ‘ä»¬çš„æ•°æ®åŒæ­¥é“¾è·¯äº†ã€‚

* **æ‰§è¡Œä¸šåŠ¡æ“ä½œï¼š**
  è¿è¡Œä½ æä¾›çš„æµ‹è¯•æ–¹æ³•ï¼ˆæˆ–å…¶ä»–èƒ½è§¦å‘ç›¸å…³è¡¨æ•°æ®å˜æ›´çš„ä¸šåŠ¡æ“ä½œï¼‰ï¼š

    ```java
    // åœ¨ä½ çš„æµ‹è¯•ç±»æˆ–æœåŠ¡ä¸­æ‰§è¡Œ
    @Test
    public void test_draw_for_es_sync() { // ç»™æµ‹è¯•æ–¹æ³•ä¸€ä¸ªæ›´æ˜ç¡®çš„åç§°
        for (int i = 0; i < 10; i++) { // å¯ä»¥å…ˆå°‘é‡æµ‹è¯•ï¼Œæ¯”å¦‚1-2æ¬¡
            ActivityDrawRequestDTO request = new ActivityDrawRequestDTO();
            request.setActivityId(100301L); // ç¡®ä¿è¿™ä¸ªæ´»åŠ¨IDå­˜åœ¨ä¸”ä¼šæ“ä½œä½ ç›‘å¬çš„è¡¨
            request.setUserId("xiaofuge_es_test_" + i); // ä½¿ç”¨ä¸åŒçš„ç”¨æˆ·IDï¼Œé¿å…ä¸»é”®å†²çª
            Response<ActivityDrawResponseDTO> response = raffleActivityService.draw(request);
            log.info("ESåŒæ­¥æµ‹è¯• - æŠ½å¥–è¯·æ±‚å‚æ•°ï¼š{}", JSON.toJSONString(request));
            log.info("ESåŒæ­¥æµ‹è¯• - æŠ½å¥–æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(response));
            // å¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸ªçŸ­æš‚çš„å»¶æ—¶ï¼Œç­‰å¾…CanalåŒæ­¥
            try { Thread.sleep(500); } catch (InterruptedException ignored) {}
        }
    }
    
    @Test
    public void test_calendarSignRebate_for_es_sync() throws InterruptedException {
        String userIdForSign = "xiaofuge_sign_test_01";
        Response<Boolean> response = raffleActivityService.calendarSignRebate(userIdForSign);
        log.info("ESåŒæ­¥æµ‹è¯• - ç­¾åˆ°è¿”åˆ©ç”¨æˆ·IDï¼š{}", userIdForSign);
        log.info("ESåŒæ­¥æµ‹è¯• - ç­¾åˆ°è¿”åˆ©æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(response));
        // new CountDownLatch(1).await(); // å¦‚æœæ˜¯æƒ³åœ¨æµ‹è¯•æ–¹æ³•ç»“æŸå‰é˜»å¡ï¼Œå¯ä»¥ä¿ç•™ï¼Œå¦åˆ™å»æ‰
    }
    ```

  **ç¡®ä¿è¿™äº›æ“ä½œä¼šä¿®æ”¹ä½ é€šè¿‡Canalç›‘å¬çš„è¡¨ (ä¾‹å¦‚ `raffle_activity_order_xx` æˆ– `user_raffle_order_xx`)ã€‚**
* **è§‚å¯Ÿæ—¥å¿—ï¼š**

   * MySQLçš„binlogæ˜¯å¦äº§ç”Ÿæ–°æ¡ç›®ã€‚
   * Canal Serverçš„å¯¹åº”destinationæ—¥å¿—æ˜¯å¦æœ‰æ–°çš„æ•°æ®æ‹‰å–å’Œè§£æè®°å½•ã€‚
   * Canal Adapterçš„æ—¥å¿—æ˜¯å¦æœ‰æ¥æ”¶åˆ°æ•°æ®å¹¶å°è¯•å†™å…¥ESçš„è®°å½•ã€‚æ³¨æ„æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ã€‚
* **åœ¨Kibana Discoveré¡µé¢æŸ¥çœ‹æ•°æ®ï¼š**

   * å¯¼èˆªåˆ° "Discover"é¡µé¢ (`http://127.0.0.1:5601/app/discover`)ã€‚
   * é€‰æ‹©ä½ åˆšåˆšåˆ›å»ºçš„ç´¢å¼•æ¨¡å¼ (ä¾‹å¦‚ `big_market.raffle_activity_order`)ã€‚
   * è°ƒæ•´æ—¶é—´èŒƒå›´åˆ°â€œæœ€è¿‘å‡ åˆ†é’Ÿâ€æˆ–â€œä»Šå¤©â€ã€‚
   * ä½ åº”è¯¥èƒ½çœ‹åˆ°ç”± `test_draw()` æˆ– `test_calendarSignRebate()` æ“ä½œäº§ç”Ÿçš„æ–°çš„æ•°æ®è®°å½•å·²ç»åŒæ­¥åˆ°äº†Elasticsearchä¸­ï¼ğŸ‰
   * å°è¯•æœç´¢è¿™äº›æ–°è®°å½•ï¼Œä¾‹å¦‚æŒ‰ `_user_id` æˆ– `_order_id` æœç´¢ã€‚

## ğŸ’¡ å…³é”®æŒ‘æˆ˜ä¸æ€è€ƒ

* **åˆ†ç‰‡é”®çš„å¤„ç†ï¼š** Canal Adapteré€šå¸¸éœ€è¦çŸ¥é“å¦‚ä½•ä»æºæ•°æ®ä¸­æå–ESæ–‡æ¡£çš„ `_id`ã€‚å¦‚æœä½ çš„åˆ†ç‰‡é”®ï¼ˆå¦‚ç”¨æˆ·IDï¼‰æœ¬èº«ä¸æ˜¯MySQLè¡¨çš„ä¸»é”®ï¼Œæˆ–è€…ESçš„ `_id` éœ€è¦ç”±å¤šä¸ªå­—æ®µç»„åˆè€Œæˆï¼Œä½ å¯èƒ½éœ€è¦åœ¨Adapterçš„YMLé…ç½®ä¸­è¿›è¡Œæ›´å¤æ‚çš„`pk`å®šä¹‰æˆ–ä½¿ç”¨è„šæœ¬è¿›è¡Œè½¬æ¢ã€‚
* **ä¸€è‡´æ€§ä¸å»¶è¿Ÿï¼š** è¿™æ˜¯ä¸€å¥—å‡†å®æ—¶åŒæ­¥ç³»ç»Ÿï¼Œæ•°æ®ä»MySQLåˆ°ESå¯è¢«æœç´¢ä¹‹é—´å­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿã€‚éœ€è¦ç›‘æ§è¿™ä¸ªå»¶è¿Ÿï¼Œç¡®ä¿å…¶åœ¨å¯æ¥å—èŒƒå›´å†…ã€‚
* **Mappingçš„é‡è¦æ€§ï¼š** å†æ¬¡å¼ºè°ƒï¼Œåœ¨ESä¸­ä¸ºå­—æ®µè®¾ç½®æ­£ç¡®çš„ç±»å‹ï¼ˆ`keyword`, `text`, `date`, `integer`ç­‰ï¼‰å¯¹äºåç»­çš„æœç´¢ã€èšåˆã€æ’åºè‡³å…³é‡è¦ã€‚ç›´æ¥ä½¿ç”¨`text`ç±»å‹ä½œä¸ºæ‰€æœ‰å­—æ®µçš„é»˜è®¤ç±»å‹æ˜¯ä¸å¯å–çš„ã€‚
* **Canal Adapterçš„æ·±å…¥å­¦ä¹ ï¼š** Canal Adapterçš„é…ç½®ï¼ˆç‰¹åˆ«æ˜¯YMLæ˜ å°„æ–‡ä»¶ï¼‰æœ‰å¾ˆå¤šç»†èŠ‚å’Œé«˜çº§åŠŸèƒ½ï¼ˆå¦‚å­—æ®µè¿‡æ»¤ã€é‡å‘½åã€ETLè„šæœ¬ç­‰ï¼‰ï¼Œå€¼å¾—æ·±å…¥ç ”ç©¶å…¶å®˜æ–¹æ–‡æ¡£ã€‚
* **å…¨é‡ä¸å¢é‡çš„é…åˆï¼š** å¯¹äºå†å²æ•°æ®çš„åˆå§‹åŒ–ï¼Œä»ç„¶éœ€è¦ä¸€ä¸ªå…¨é‡åŒæ­¥çš„æ–¹æ¡ˆã€‚Canalä¸»è¦è§£å†³çš„æ˜¯å¢é‡æ•°æ®çš„åŒæ­¥ã€‚

## ğŸ æ€»ç»“

é€šè¿‡æ•´åˆè¥é”€å¹³å°çš„åˆ†åº“åˆ†è¡¨MySQLã€å¼ºå¤§çš„CDCå·¥å…·Canalä»¥åŠä¾¿æ·çš„Canal Adapterï¼Œæˆ‘ä»¬æˆåŠŸåœ°ä¸ºè¿è¥å›¢é˜Ÿæ„å»ºäº†ä¸€å¥—èƒ½å¤Ÿå°†åˆ†æ•£æ•°æ®èšåˆåˆ°Elasticsearchï¼Œå¹¶å®ç°å‡†å®æ—¶æŸ¥è¯¢å’Œåˆ†æçš„è§£å†³æ–¹æ¡ˆã€‚è§£å†³äº†åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„æ•°æ®èšåˆéš¾é¢˜ã€‚

è¿™å¥—æ¶æ„åœ¨å¤„ç†Cç«¯é«˜å¹¶å‘å†™å…¥å’Œè¿è¥ä¾§å¤æ‚æŸ¥è¯¢çš„åœºæ™¯ä¸­éå¸¸å®ç”¨ã€‚å¸Œæœ›æœ¬ç¯‡å®æˆ˜åˆ†äº«ï¼Œèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è¿™å¥—æŠ€æœ¯æ ˆã€‚ğŸ’ª

---
