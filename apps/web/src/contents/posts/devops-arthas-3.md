---
title: "Arthasï¼ˆä¸€):å®‰è£…ä¸ä½¿ç”¨"  
category: "DevOps"  
publishedAt: "2025-05-21"  
summary: "DevOps"  
tags:  
  - DevOps
banner: /images/banner/posts/dev-ops/dev-ops-arthas-01.png
alt: "å›¾ç‰‡æ›¿ä»£æ–‡æœ¬"  
mathjax: false
---


# Arthas

## ä¸‹è½½ Arthas

Arthas åªéœ€è¦ä¸€ä¸ª `arthas-boot.jar` æ–‡ä»¶ã€‚ä¸‹è½½å’Œå¸è½½éƒ½å¾ˆç®€å•ã€‚

```
curl -O <https://arthas.aliyun.com/arthas-boot.jar>
```

ä¸‹è½½å®Œæˆåï¼Œè¿›å…¥ `arthas-boot.jar` æ‰€åœ¨çš„ç›®å½•ï¼Œæ‰§è¡Œï¼š

```
java -jar arthas-boot.jar
```

ä¹‹åArthas ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰æœºå™¨ä¸Šè¿è¡Œçš„ Java è¿›ç¨‹ï¼Œå¹¶åˆ—å‡ºå®ƒä»¬çš„ PIDï¼ˆè¿›ç¨‹IDï¼‰ã€‚

è¿™æ—¶æˆ‘ä»¬åªéœ€è¾“å…¥ Spring Boot åº”ç”¨å¯¹åº”çš„æ•°å­—ï¼ˆæ¯”å¦‚ï¼š3ï¼‰ï¼Œç„¶åå›è½¦ã€‚

æˆåŠŸè¿æ¥åï¼Œä¼šçœ‹åˆ° Arthas çš„ Logo å’Œ arthas> æç¤ºç¬¦ï¼Œè¿™è¡¨ç¤ºæˆ‘ä»¬å·²ç»è¿›å…¥ Arthas æ§åˆ¶å°äº†ï¼ğŸ¥³

---

## åˆæ­¥æ¢ç´¢

### åˆæ¢ JVM çŠ¶æ€ï¼š`dashboard`

è¿™æ˜¯æˆ‘ä»¬è¿›å…¥ Arthas åå¯ä»¥æ•²çš„ç¬¬ä¸€ä¸ªå‘½ä»¤ã€‚å®ƒä¼šæ˜¾ç¤ºå½“å‰ JVM çš„æ¦‚è§ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬çº¿ç¨‹ã€å†…å­˜ã€GCã€CPU ç­‰å®æ—¶æ•°æ®ã€‚

```bash
dashboard
```

dashboard ä¼šæ¯éš” 5 ç§’åˆ·æ–°ä¸€æ¬¡ã€‚å¯ä»¥çœ‹åˆ° CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€çº¿ç¨‹æ•°é‡ç­‰ç­‰ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„â€œå¥åº·æ£€æŸ¥â€å‘½ä»¤ã€‚æŒ‰ Ctrl+C æˆ– q é€€å‡º dashboardã€‚

### æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ï¼šthread

å¦‚æœå‘ç°ï¼Œdashboard é‡Œ CPU é£™é«˜ï¼Œæˆ–è€…çº¿ç¨‹æ•°å¼‚å¸¸ï¼Œthread å‘½ä»¤å°±èƒ½å¸®æˆ‘ä»¬æ·±å…¥æ’æŸ¥ã€‚ğŸ•µï¸

```bash
thread
```

å®ƒä¼šåˆ—å‡ºæ‰€æœ‰çº¿ç¨‹ä»¥åŠå®ƒä»¬çš„çŠ¶æ€ã€‚å¦‚æœä½ æƒ³çœ‹å“ªä¸ªçº¿ç¨‹åœ¨æ¶ˆè€— CPUï¼Œå¯ä»¥ä½¿ç”¨`thread -n 3`(åˆ—å‡º CPU å ç”¨æœ€é«˜çš„ 3 ä¸ªçº¿ç¨‹)ã€‚ å¦‚æœæ€€ç–‘æœ‰æ­»é”ï¼Œå¯ä»¥ç›´æ¥æ•² thread -b (æŸ¥æ‰¾æ­»é”)ã€‚

è¿™ä¸ªå‘½ä»¤å¯¹äºå‘ç°çº¿ç¨‹é˜»å¡ã€æ­»é”ã€CPU å ç”¨è¿‡é«˜çš„é—®é¢˜éå¸¸æœ‰ç”¨ã€‚

### æŸ¥æ‰¾ç±»ï¼šsc (Search Class)

ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³çœ‹ `UserService` é‡Œçš„å˜é‡ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°è¿™ä¸ªç±»ã€‚

```bash
sc com.example.service.UserService
```

ä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼š`sc *UserService*` å¦‚æœæƒ³çœ‹ç±»çš„è¯¦ç»†ä¿¡æ¯ï¼ˆæ¯”å¦‚ç±»åŠ è½½å™¨ã€æºæ–‡ä»¶è·¯å¾„ç­‰ï¼‰ï¼Œå¯ä»¥åŠ ä¸Š -d å‚æ•°ã€‚

### æŸ¥æ‰¾æ–¹æ³•ï¼šsm(Search Method)

æŸ¥æ‰¾æ–¹æ³•ï¼šsm (Search Method)

```bash
sm com.example.arthasdemo.service.UserService
```

åŒæ ·ï¼ŒåŠ  -d å¯ä»¥çœ‹æ–¹æ³•ç­¾åã€æ‰€åœ¨è¡Œå·ç­‰è¯¦ç»†ä¿¡æ¯ã€‚

### æŸ¥çœ‹è¿è¡Œæ—¶å˜é‡ï¼šognl / getstatic

è¿™æ˜¯Arthasçš„ç²¾é«“ä¹‹ä¸€ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿåƒå†™ä»£ç ä¸€æ ·ï¼Œåœ¨è¿è¡Œæ—¶è·å–å¹¶æ“ä½œå¯¹è±¡ã€‚

åŠ å…¥ç°åœ¨æˆ‘ä»¬çŸ¥é“ UserService é‡Œæœ‰ä¸€ä¸ªé™æ€å˜é‡ totalUserCountï¼Œå®ƒè®°å½•äº†ç”¨æˆ·æ€»é‡ã€‚åœ¨æ—¥å¿—é‡Œå¯èƒ½æ²¡æ‰“å‡ºæ¥ï¼Œä½†ç°åœ¨ä½ æƒ³çŸ¥é“å®ƒçš„å®æ—¶å€¼ã€‚éš¾é“è¦åŠ ä¸ªæ—¥å¿—ç„¶åé‡å¯å—ï¼Ÿæ³¨æ„ç°åœ¨æˆ‘ä»¬æ˜¯çº¿ä¸Šç¯å¢ƒã€‚

```bash
ognl '@com.example.arthasdemo.service.UserService@totalUserCount'
or
getstatic com.example.arthasdemo.service.UserService totalUserCount
```

æ„ä¸æ„å¤–ï¼ŸğŸ¤¯ æˆ‘ä»¬ä¸éœ€è¦é‡å¯æœåŠ¡ï¼Œä¸éœ€è¦åŠ ä¸€è¡Œæ—¥å¿—ï¼Œå°±èƒ½ç›´æ¥çœ‹åˆ°è¿™ä¸ªé™æ€å˜é‡çš„å®æ—¶å€¼ã€‚

ç”šè‡³å¯ä»¥ç›´æ¥åœ¨ Arthas é‡Œè°ƒç”¨æ–¹æ³•æ¥ä¿®æ”¹å˜é‡çš„å€¼ï¼ˆä½†è¦æ…ç”¨ï¼Œçº¿ä¸Šç¯å¢ƒå¯èƒ½é€ æˆä¸¥é‡åæœï¼Œè¦å¯¹çº¿ä¸Šç¯å¢ƒä¿æŒæ•¬ç•ï¼‰âš ï¸

### é€€å‡º Arthasï¼šquit æˆ– exitã€‚

å½“æˆ‘ä»¬å®Œæˆæ’æŸ¥åï¼Œè¾“å…¥ quit æˆ– exit å³å¯é€€å‡º Arthas æ§åˆ¶å°ï¼Œä½†ä¸ä¼šåœæ­¢ Java åº”ç”¨ã€‚

> Arthas çš„å­¦ä¹ éœ€è¦å¤šç»ƒå¤šç”¨ã€‚ç»§ç»­å®è·µï¼Œä¿æŒé¡¹ç›®é©±åŠ¨ï¼ŒåŠªåŠ›è®©çº¿ä¸Šæ’æŸ¥èƒ½åŠ›è¾¾åˆ°ä¸€ä¸ªæ–°é«˜åº¦ã€‚

ç†Ÿç»ƒä½¿ç”¨ï¼šognl / getstatic ï¼Œè¿™å¾ˆå…³é”®ã€‚èƒ½è®©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å®æ—¶æŸ¥çœ‹å’Œä¿®æ”¹ä»»ä½•å¯¹è±¡çš„å­—æ®µã€è°ƒç”¨ä»»ä½•æ–¹æ³•ï¼Œå½»åº•æ‘†è„±äº†æ‰“æ—¥å¿—-é‡å¯-éƒ¨ç½²çš„å™©æ¢¦ã€‚
